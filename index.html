<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@solana/buffer-layout</title><meta name="description" content="Documentation for @solana/buffer-layout"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@solana/buffer-layout</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>@solana/buffer-layout</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#solanabuffer-layout" id="solanabuffer-layout" style="color: inherit; text-decoration: none;">
  <h1>@solana/buffer-layout</h1>
</a>
<p><code>@solana/buffer-layout</code> is a TypeScript fork of <code>buffer-layout</code>. Same API, just adds types and TypeScript docs.</p>

<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
  <h2>Installation</h2>
</a>
<p>Install with <code>npm install @solana/buffer-layout</code>.</p>
<p>Development and testing is done using Node.js, supporting versions 5.10
and later.</p>

<a href="#buffer-layout" id="buffer-layout" style="color: inherit; text-decoration: none;">
  <h1>buffer-layout</h1>
</a>
<p><a href="https://www.npmjs.com/package/buffer-layout" title="View this project on NPM"><img src="https://img.shields.io/npm/v/buffer-layout.svg" alt="NPM version"></a>
<a href="https://travis-ci.org/pabigot/buffer-layout" title="Check build status on TravisCI"><img src="https://travis-ci.org/pabigot/buffer-layout.svg?branch=master" alt="Build Status"></a>
<a href="https://coveralls.io/github/pabigot/buffer-layout?branch=master" title="Check coverage status on Coveralls"><img src="https://coveralls.io/repos/pabigot/buffer-layout/badge.svg?branch=master&service=github" alt="Coverage Status"></a></p>
<p>buffer-layout is a utility module implemented in pure JavaScript that
supports translations between JavaScript values and Buffers.  It is made
available through <a href="https://github.com/pabigot/buffer-layout">github</a> and
released under the MIT license.</p>
<p>Layout support is provided for these types of data:</p>
<ul>
<li>Signed and unsigned integral values from 1 to 6 bytes in length, in
little-endian or big-endian format;</li>
<li>Signed and unsigned 64-bit integral values decoded as integral
Numbers;</li>
<li>Float and double values (also little-endian or big-endian);</li>
<li>Sequences of instances of an arbitrary layout, with constant or
data-dependent length;</li>
<li>Structures with named fields containing arbitrary layouts;</li>
<li>Unions of variant layouts where the type of data is recorded in a
prefix value, another layout element, or provided externally;</li>
<li>Bit fields within 8, 16, 24, or 32-bit unsigned integers, numbering
from the least or most significant bit;</li>
<li>NUL-terminated C strings;</li>
<li>Blobs of fixed or variable-length raw data.</li>
</ul>

<a href="#examples" id="examples" style="color: inherit; text-decoration: none;">
  <h2>Examples</h2>
</a>
<p>All examples are from the <code>test/examples.js</code> unit test and assume the
following context:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">assert</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;assert&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">util</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;util&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">lo</span><span class="hl-1"> = </span><span class="hl-3">require</span><span class="hl-1">(</span><span class="hl-4">&#39;buffer-layout&#39;</span><span class="hl-1">);</span>
</code></pre>
<p>The examples give only a taste of what can be done.  Structures, unions,
and sequences can nest; <a href="http://pabigot.github.io/buffer-layout/module-Layout-UnionDiscriminator.html">union
discriminators</a>
can be within the union or external to it; sequence and blob lengths may
be fixed or read from the buffer.</p>
<p>For full details see the <a href="http://pabigot.github.io/buffer-layout/">documentation</a>.</p>

<a href="#four-element-array-of-16-bit-signed-little-endian-integers" id="four-element-array-of-16-bit-signed-little-endian-integers" style="color: inherit; text-decoration: none;">
  <h3>Four-element array of 16-bit signed little-endian integers</h3>
</a>
<p>The C definition:</p>
<pre><code><span class="hl-5">int16_t</span><span class="hl-1"> </span><span class="hl-5">arr</span><span class="hl-1">[</span><span class="hl-6">4</span><span class="hl-1">] = { </span><span class="hl-6">1</span><span class="hl-1">, -</span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-6">3</span><span class="hl-1">, -</span><span class="hl-6">3</span><span class="hl-1"> };</span>
</code></pre>
<p>The buffer-layout way:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ds</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">seq</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">s16</span><span class="hl-1">(), </span><span class="hl-6">4</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">alloc</span><span class="hl-1">(</span><span class="hl-6">8</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">([</span><span class="hl-6">1</span><span class="hl-1">, -</span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-6">3</span><span class="hl-1">, -</span><span class="hl-6">3</span><span class="hl-1">], </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">4</span><span class="hl-1"> * </span><span class="hl-6">2</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;0100ffff0300fdff&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), [</span><span class="hl-6">1</span><span class="hl-1">, -</span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-6">3</span><span class="hl-1">, -</span><span class="hl-6">3</span><span class="hl-1">]);</span>
</code></pre>
<p>See <a href="http://pabigot.github.io/buffer-layout/module-Layout-Int.html">Int</a>
and <a href="http://pabigot.github.io/buffer-layout/module-Layout-Sequence.html">Sequence</a>.</p>

<a href="#a-native-c-struct-on-a-32-bit-little-endian-machine" id="a-native-c-struct-on-a-32-bit-little-endian-machine" style="color: inherit; text-decoration: none;">
  <h3>A native C <code>struct</code> on a 32-bit little-endian machine</h3>
</a>
<p>The C definition:</p>
<pre><code><span class="hl-5">struct</span><span class="hl-1"> </span><span class="hl-5">ds</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">uint8_t</span><span class="hl-1"> </span><span class="hl-5">v</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">uint32_t</span><span class="hl-1"> </span><span class="hl-5">u32</span><span class="hl-1">;</span><br/><span class="hl-1">} </span><span class="hl-5">st</span><span class="hl-1">;</span>
</code></pre>
<p>The buffer-layout way:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ds</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">struct</span><span class="hl-1">([</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u8</span><span class="hl-1">(</span><span class="hl-4">&#39;v&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">                    </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">seq</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u8</span><span class="hl-1">(), </span><span class="hl-6">3</span><span class="hl-1">), </span><span class="hl-7">// alignment padding</span><br/><span class="hl-1">                    </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u32</span><span class="hl-1">(</span><span class="hl-4">&#39;u32&#39;</span><span class="hl-1">)]);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">offsetOf</span><span class="hl-1">(</span><span class="hl-4">&#39;u32&#39;</span><span class="hl-1">), </span><span class="hl-6">4</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">alloc</span><span class="hl-1">(</span><span class="hl-6">8</span><span class="hl-1">);</span><br/><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">fill</span><span class="hl-1">(</span><span class="hl-6">0xbd</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">({</span><span class="hl-5">v:</span><span class="hl-1"> </span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-5">u32:</span><span class="hl-1"> </span><span class="hl-6">0x12345678</span><span class="hl-1">}, </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1"> + </span><span class="hl-6">3</span><span class="hl-1"> + </span><span class="hl-6">4</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;01bdbdbd78563412&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), {</span><span class="hl-5">v:</span><span class="hl-1"> </span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-5">u32:</span><span class="hl-1"> </span><span class="hl-6">0x12345678</span><span class="hl-1">});</span>
</code></pre>
<p>Note that the C language requires padding which must be explicitly added
in the buffer-layout structure definition.  Since the padding is not
accessible, the corresponding layout has no
<a href="http://pabigot.github.io/buffer-layout/module-Layout-Layout.html#property">property</a>.</p>
<p>See <a href="http://pabigot.github.io/buffer-layout/module-Layout-Structure.html">Structure</a>.</p>

<a href="#a-packed-c-struct-on-a-32-bit-little-endian-machine" id="a-packed-c-struct-on-a-32-bit-little-endian-machine" style="color: inherit; text-decoration: none;">
  <h3>A packed C <code>struct</code> on a 32-bit little-endian machine</h3>
</a>
<p>The C definition:</p>
<pre><code><span class="hl-5">struct</span><span class="hl-1"> </span><span class="hl-5">ds</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">uint8_t</span><span class="hl-1"> </span><span class="hl-5">v</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">uint32_t</span><span class="hl-1"> </span><span class="hl-5">u32</span><span class="hl-1">;</span><br/><span class="hl-1">} </span><span class="hl-3">__attribute__</span><span class="hl-1">((</span><span class="hl-5">__packed__</span><span class="hl-1">)) </span><span class="hl-5">st</span><span class="hl-1">;</span>
</code></pre>
<p>The buffer-layout way:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ds</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">struct</span><span class="hl-1">([</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u8</span><span class="hl-1">(</span><span class="hl-4">&#39;v&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">                    </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u32</span><span class="hl-1">(</span><span class="hl-4">&#39;u32&#39;</span><span class="hl-1">)]);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">offsetOf</span><span class="hl-1">(</span><span class="hl-4">&#39;u32&#39;</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">alloc</span><span class="hl-1">(</span><span class="hl-6">5</span><span class="hl-1">);</span><br/><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">fill</span><span class="hl-1">(</span><span class="hl-6">0xbd</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">({</span><span class="hl-5">v:</span><span class="hl-1"> </span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-5">u32:</span><span class="hl-1"> </span><span class="hl-6">0x12345678</span><span class="hl-1">}, </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1"> + </span><span class="hl-6">4</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;0178563412&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), {</span><span class="hl-5">v:</span><span class="hl-1"> </span><span class="hl-6">1</span><span class="hl-1">, </span><span class="hl-5">u32:</span><span class="hl-1"> </span><span class="hl-6">0x12345678</span><span class="hl-1">});</span>
</code></pre>

<a href="#a-tagged-union-of-4-byte-values" id="a-tagged-union-of-4-byte-values" style="color: inherit; text-decoration: none;">
  <h3>A tagged union of 4-byte values</h3>
</a>
<p>Assume a 5-byte packed structure where the interpretation of the last
four bytes depends on the first byte.  The C definition:</p>
<pre><code><span class="hl-5">struct</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">uint8_t</span><span class="hl-1"> </span><span class="hl-5">t</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">union</span><span class="hl-1"> </span><span class="hl-5">ds</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">uint8_t</span><span class="hl-1"> </span><span class="hl-5">u8</span><span class="hl-1">[</span><span class="hl-6">4</span><span class="hl-1">];  </span><span class="hl-7">// default interpretation</span><br/><span class="hl-1">    </span><span class="hl-5">int16_t</span><span class="hl-1"> </span><span class="hl-5">s16</span><span class="hl-1">[</span><span class="hl-6">2</span><span class="hl-1">]; </span><span class="hl-7">// when t is &#39;h&#39;</span><br/><span class="hl-1">    </span><span class="hl-5">uint32_t</span><span class="hl-1"> </span><span class="hl-5">u32</span><span class="hl-1">;   </span><span class="hl-7">// when t is &#39;w&#39;</span><br/><span class="hl-1">    </span><span class="hl-5">float</span><span class="hl-1"> </span><span class="hl-5">f32</span><span class="hl-1">;      </span><span class="hl-7">// when t is &#39;f&#39;</span><br/><span class="hl-1">  } </span><span class="hl-5">u</span><span class="hl-1">;</span><br/><span class="hl-1">} </span><span class="hl-3">__attribute__</span><span class="hl-1">((</span><span class="hl-5">__packed__</span><span class="hl-1">)) </span><span class="hl-5">un</span><span class="hl-1">;</span>
</code></pre>
<p>The buffer-layout way:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">t</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u8</span><span class="hl-1">(</span><span class="hl-4">&#39;t&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">un</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">union</span><span class="hl-1">(</span><span class="hl-5">t</span><span class="hl-1">, </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">seq</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u8</span><span class="hl-1">(), </span><span class="hl-6">4</span><span class="hl-1">, </span><span class="hl-4">&#39;u8&#39;</span><span class="hl-1">));</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">nul</span><span class="hl-1"> = </span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;n&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-4">&#39;nul&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">u32</span><span class="hl-1"> = </span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;w&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u32</span><span class="hl-1">(), </span><span class="hl-4">&#39;u32&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">s16</span><span class="hl-1"> = </span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;h&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">seq</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">s16</span><span class="hl-1">(), </span><span class="hl-6">2</span><span class="hl-1">), </span><span class="hl-4">&#39;s16&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">f32</span><span class="hl-1"> = </span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;f&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">f32</span><span class="hl-1">(), </span><span class="hl-4">&#39;f32&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">alloc</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-5">span</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), {</span><span class="hl-5">t:</span><span class="hl-1"> </span><span class="hl-6">0</span><span class="hl-1">, </span><span class="hl-5">u8:</span><span class="hl-1"> [</span><span class="hl-6">0</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">, </span><span class="hl-6">0</span><span class="hl-1">]});</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;6e01020304&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">)),</span><br/><span class="hl-1">                 {</span><span class="hl-5">nul:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">});</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;7778563412&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">)),</span><br/><span class="hl-1">                 {</span><span class="hl-5">u32:</span><span class="hl-1"> </span><span class="hl-6">0x12345678</span><span class="hl-1">});</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;660000bd41&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">)),</span><br/><span class="hl-1">                 {</span><span class="hl-5">f32:</span><span class="hl-1"> </span><span class="hl-6">23.625</span><span class="hl-1">});</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;a5a5a5a5a5&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">)),</span><br/><span class="hl-1">                 {</span><span class="hl-5">t:</span><span class="hl-1"> </span><span class="hl-6">0xa5</span><span class="hl-1">, </span><span class="hl-5">u8:</span><span class="hl-1"> [</span><span class="hl-6">0xa5</span><span class="hl-1">, </span><span class="hl-6">0xa5</span><span class="hl-1">, </span><span class="hl-6">0xa5</span><span class="hl-1">, </span><span class="hl-6">0xa5</span><span class="hl-1">]});</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">s16</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">({</span><span class="hl-5">s16:</span><span class="hl-1"> [</span><span class="hl-6">123</span><span class="hl-1">, -</span><span class="hl-6">123</span><span class="hl-1">]}, </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1"> + </span><span class="hl-6">2</span><span class="hl-1"> * </span><span class="hl-6">2</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;687b0085ff&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span>
</code></pre>
<p>See <a href="http://pabigot.github.io/buffer-layout/module-Layout-Union.html">Union</a>.</p>

<a href="#decoding-into-class-instances" id="decoding-into-class-instances" style="color: inherit; text-decoration: none;">
  <h3>Decoding into class instances</h3>
</a>
<p>Using the same 5-byte packet structure but with JavaScript classes
representing the union and the variants:</p>
<pre><code><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">Union</span><span class="hl-1">() { }</span><br/><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">bindConstructorLayout</span><span class="hl-1">(</span><span class="hl-5">Union</span><span class="hl-1">,</span><br/><span class="hl-1">                         </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">union</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u8</span><span class="hl-1">(</span><span class="hl-4">&#39;t&#39;</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">seq</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u8</span><span class="hl-1">(), </span><span class="hl-6">4</span><span class="hl-1">, </span><span class="hl-4">&#39;u8&#39;</span><span class="hl-1">)));</span><br/><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">Vn</span><span class="hl-1">() {}</span><br/><span class="hl-5">util</span><span class="hl-1">.</span><span class="hl-3">inherits</span><span class="hl-1">(</span><span class="hl-5">Vn</span><span class="hl-1">, </span><span class="hl-5">Union</span><span class="hl-1">);</span><br/><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">bindConstructorLayout</span><span class="hl-1">(</span><span class="hl-5">Vn</span><span class="hl-1">,</span><br/><span class="hl-1">                         </span><span class="hl-5">Union</span><span class="hl-1">.</span><span class="hl-5">layout_</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;n&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-4">&#39;nul&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">Vu32</span><span class="hl-1">(</span><span class="hl-5">v</span><span class="hl-1">) { </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">u32</span><span class="hl-1"> = </span><span class="hl-5">v</span><span class="hl-1">; }</span><br/><span class="hl-5">util</span><span class="hl-1">.</span><span class="hl-3">inherits</span><span class="hl-1">(</span><span class="hl-5">Vu32</span><span class="hl-1">, </span><span class="hl-5">Union</span><span class="hl-1">);</span><br/><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">bindConstructorLayout</span><span class="hl-1">(</span><span class="hl-5">Vu32</span><span class="hl-1">,</span><br/><span class="hl-1">                         </span><span class="hl-5">Union</span><span class="hl-1">.</span><span class="hl-5">layout_</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;w&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u32</span><span class="hl-1">(), </span><span class="hl-4">&#39;u32&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">Vs16</span><span class="hl-1">(</span><span class="hl-5">v</span><span class="hl-1">) { </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">s16</span><span class="hl-1"> = </span><span class="hl-5">v</span><span class="hl-1">; }</span><br/><span class="hl-5">util</span><span class="hl-1">.</span><span class="hl-3">inherits</span><span class="hl-1">(</span><span class="hl-5">Vs16</span><span class="hl-1">, </span><span class="hl-5">Union</span><span class="hl-1">);</span><br/><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">bindConstructorLayout</span><span class="hl-1">(</span><span class="hl-5">Vs16</span><span class="hl-1">,</span><br/><span class="hl-1">                         </span><span class="hl-5">Union</span><span class="hl-1">.</span><span class="hl-5">layout_</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;h&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">seq</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">s16</span><span class="hl-1">(), </span><span class="hl-6">2</span><span class="hl-1">), </span><span class="hl-4">&#39;s16&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-0">function</span><span class="hl-1"> </span><span class="hl-3">Vf32</span><span class="hl-1">(</span><span class="hl-5">v</span><span class="hl-1">) { </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-5">f32</span><span class="hl-1"> = </span><span class="hl-5">v</span><span class="hl-1">; }</span><br/><span class="hl-5">util</span><span class="hl-1">.</span><span class="hl-3">inherits</span><span class="hl-1">(</span><span class="hl-5">Vf32</span><span class="hl-1">, </span><span class="hl-5">Union</span><span class="hl-1">);</span><br/><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">bindConstructorLayout</span><span class="hl-1">(</span><span class="hl-5">Vf32</span><span class="hl-1">,</span><br/><span class="hl-1">                         </span><span class="hl-5">Union</span><span class="hl-1">.</span><span class="hl-5">layout_</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;f&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">f32</span><span class="hl-1">(), </span><span class="hl-4">&#39;f32&#39;</span><span class="hl-1">));</span><br/><br/><span class="hl-0">let</span><span class="hl-1"> </span><span class="hl-5">v</span><span class="hl-1"> = </span><span class="hl-5">Union</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;7778563412&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">));</span><br/><span class="hl-3">assert</span><span class="hl-1">(</span><span class="hl-5">v</span><span class="hl-1"> </span><span class="hl-0">instanceof</span><span class="hl-1"> </span><span class="hl-8">Vu32</span><span class="hl-1">);</span><br/><span class="hl-3">assert</span><span class="hl-1">(</span><span class="hl-5">v</span><span class="hl-1"> </span><span class="hl-0">instanceof</span><span class="hl-1"> </span><span class="hl-8">Union</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">v</span><span class="hl-1">.</span><span class="hl-5">u32</span><span class="hl-1">, </span><span class="hl-6">0x12345678</span><span class="hl-1">);</span><br/><br/><span class="hl-5">v</span><span class="hl-1"> = </span><span class="hl-5">Union</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;a5a5a5a5a5&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">));</span><br/><span class="hl-3">assert</span><span class="hl-1">(</span><span class="hl-5">v</span><span class="hl-1"> </span><span class="hl-0">instanceof</span><span class="hl-1"> </span><span class="hl-8">Union</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">v</span><span class="hl-1">.</span><span class="hl-5">t</span><span class="hl-1">, </span><span class="hl-6">0xa5</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">v</span><span class="hl-1">.</span><span class="hl-5">u8</span><span class="hl-1">, [</span><span class="hl-6">0xa5</span><span class="hl-1">, </span><span class="hl-6">0xa5</span><span class="hl-1">, </span><span class="hl-6">0xa5</span><span class="hl-1">, </span><span class="hl-6">0xa5</span><span class="hl-1">]);</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">alloc</span><span class="hl-1">(</span><span class="hl-5">Union</span><span class="hl-1">.</span><span class="hl-5">layout_</span><span class="hl-1">.</span><span class="hl-5">span</span><span class="hl-1">);</span><br/><span class="hl-5">v</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Vf32</span><span class="hl-1">(</span><span class="hl-6">23.625</span><span class="hl-1">);</span><br/><span class="hl-5">v</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;660000bd41&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><br/><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">fill</span><span class="hl-1">(</span><span class="hl-6">0xFF</span><span class="hl-1">);</span><br/><span class="hl-5">v</span><span class="hl-1"> = </span><span class="hl-0">new</span><span class="hl-1"> </span><span class="hl-3">Vn</span><span class="hl-1">();</span><br/><span class="hl-5">v</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;6effffffff&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span>
</code></pre>
<p>Note that one variant (<code>&#39;n&#39;</code>) carries no data, leaving the remainder of
the buffer unchanged when stored.</p>
<p>See
<a href="http://pabigot.github.io/buffer-layout/module-Layout-Layout.html#makeDestinationObject">Layout.makeDestinationObject()</a>
and
<a href="http://pabigot.github.io/buffer-layout/module-Layout.html#.bindConstructorLayout">bindConstructorLayout</a>.</p>

<a href="#packed-bit-fields-on-a-little-endian-machine" id="packed-bit-fields-on-a-little-endian-machine" style="color: inherit; text-decoration: none;">
  <h3>Packed bit fields on a little-endian machine</h3>
</a>
<p>The C definition:</p>
<pre><code><span class="hl-5">struct</span><span class="hl-1"> </span><span class="hl-5">ds</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">unsigned</span><span class="hl-1"> </span><span class="hl-5">int</span><span class="hl-1"> </span><span class="hl-9">b00l03</span><span class="hl-1">: </span><span class="hl-6">3</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">unsigned</span><span class="hl-1"> </span><span class="hl-5">int</span><span class="hl-1"> </span><span class="hl-9">flg03</span><span class="hl-1">: </span><span class="hl-6">1</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">unsigned</span><span class="hl-1"> </span><span class="hl-5">int</span><span class="hl-1"> </span><span class="hl-9">b04l18</span><span class="hl-1">: </span><span class="hl-6">24</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">unsigned</span><span class="hl-1"> </span><span class="hl-5">int</span><span class="hl-1"> </span><span class="hl-9">b1Cl04</span><span class="hl-1">: </span><span class="hl-6">4</span><span class="hl-1">;</span><br/><span class="hl-1">} </span><span class="hl-5">st</span><span class="hl-1">;</span>
</code></pre>
<p>The buffer-layout way:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ds</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">bits</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u32</span><span class="hl-1">());</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">alloc</span><span class="hl-1">(</span><span class="hl-6">4</span><span class="hl-1">);</span><br/><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">addField</span><span class="hl-1">(</span><span class="hl-6">3</span><span class="hl-1">, </span><span class="hl-4">&#39;b00l03&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">addBoolean</span><span class="hl-1">(</span><span class="hl-4">&#39;flg03&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">addField</span><span class="hl-1">(</span><span class="hl-6">24</span><span class="hl-1">, </span><span class="hl-4">&#39;b04l18&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">addField</span><span class="hl-1">(</span><span class="hl-6">4</span><span class="hl-1">, </span><span class="hl-4">&#39;b1Cl04&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">fill</span><span class="hl-1">(</span><span class="hl-6">0xff</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">({</span><span class="hl-5">b00l03:</span><span class="hl-1"> </span><span class="hl-6">3</span><span class="hl-1">, </span><span class="hl-5">b04l18:</span><span class="hl-1"> </span><span class="hl-6">24</span><span class="hl-1">, </span><span class="hl-5">b1Cl04:</span><span class="hl-1"> </span><span class="hl-6">4</span><span class="hl-1">}, </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">4</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;8b010040&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">),</span><br/><span class="hl-1">                 {</span><span class="hl-5">b00l03:</span><span class="hl-1"> </span><span class="hl-6">3</span><span class="hl-1">, </span><span class="hl-5">flg03:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">, </span><span class="hl-5">b04l18:</span><span class="hl-1"> </span><span class="hl-6">24</span><span class="hl-1">, </span><span class="hl-5">b1Cl04:</span><span class="hl-1"> </span><span class="hl-6">4</span><span class="hl-1">});</span>
</code></pre>
<p>See <a href="http://pabigot.github.io/buffer-layout/module-Layout-BitStructure.html">BitStructure</a>.</p>

<a href="#64-bit-values-as-numbers" id="64-bit-values-as-numbers" style="color: inherit; text-decoration: none;">
  <h3>64-bit values as Numbers</h3>
</a>
<p>The C definition:</p>
<pre><code><span class="hl-5">uint64_t</span><span class="hl-1"> </span><span class="hl-5">v</span><span class="hl-1"> = 0</span><span class="hl-5">x0102030405060708ULL</span><span class="hl-1">;</span>
</code></pre>
<p>The buffer-layout way:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ds</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">nu64be</span><span class="hl-1">();</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;0102030405060708&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">v</span><span class="hl-1"> = </span><span class="hl-6">72623859790382856</span><span class="hl-1">;</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">nv</span><span class="hl-1"> = </span><span class="hl-5">v</span><span class="hl-1"> - </span><span class="hl-6">6</span><span class="hl-1">;</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">v</span><span class="hl-1">, </span><span class="hl-5">nv</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-5">nv</span><span class="hl-1">);</span>
</code></pre>
<p>Note that because the exact value is not less than 2^53 it cannot be
represented as a JavaScript Number, and is instead approximated by a
nearby representable integer that is equivalent within Numbers.</p>
<p>See <a href="http://pabigot.github.io/buffer-layout/module-Layout-NearUInt64.html">NearUInt64</a>.</p>

<a href="#a-nul-terminated-c-string" id="a-nul-terminated-c-string" style="color: inherit; text-decoration: none;">
  <h3>A NUL-terminated C string</h3>
</a>
<p>The C definition:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">char</span><span class="hl-1"> str[] = </span><span class="hl-4">&quot;hi!&quot;</span><span class="hl-1">;</span>
</code></pre>
<p>The buffer-layout way:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ds</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">cstr</span><span class="hl-1">();</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">alloc</span><span class="hl-1">(</span><span class="hl-6">8</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">(</span><span class="hl-4">&#39;hi!&#39;</span><span class="hl-1">, </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">3</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">slen</span><span class="hl-1"> = </span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">getSpan</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">slen</span><span class="hl-1">, </span><span class="hl-6">4</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;68692100&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">slice</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">, </span><span class="hl-5">slen</span><span class="hl-1">)), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-4">&#39;hi!&#39;</span><span class="hl-1">);</span>
</code></pre>
<p>See <a href="http://pabigot.github.io/buffer-layout/module-Layout-CString.html">CString</a>.</p>

<a href="#a-fixed-length-block-of-data-offset-within-a-buffer" id="a-fixed-length-block-of-data-offset-within-a-buffer" style="color: inherit; text-decoration: none;">
  <h3>A fixed-length block of data offset within a buffer</h3>
</a>
<p>The buffer-layout way:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">ds</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">blob</span><span class="hl-1">(</span><span class="hl-6">4</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;0102030405060708&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;03040506&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">ds</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">, </span><span class="hl-6">2</span><span class="hl-1">)), </span><span class="hl-6">0</span><span class="hl-1">);</span>
</code></pre>
<p>See <a href="http://pabigot.github.io/buffer-layout/module-Layout-Blob.html">Blob</a>.</p>

<a href="#a-variable-length-array-of-pairs-of-c-strings" id="a-variable-length-array-of-pairs-of-c-strings" style="color: inherit; text-decoration: none;">
  <h3>A variable-length array of pairs of C strings</h3>
</a>
<p>The buffer-layout way:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">pr</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">seq</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">cstr</span><span class="hl-1">(), </span><span class="hl-6">2</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">n</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u8</span><span class="hl-1">(</span><span class="hl-4">&#39;n&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">vla</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">seq</span><span class="hl-1">(</span><span class="hl-5">pr</span><span class="hl-1">, </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">offset</span><span class="hl-1">(</span><span class="hl-5">n</span><span class="hl-1">, -</span><span class="hl-6">1</span><span class="hl-1">), </span><span class="hl-4">&#39;a&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">st</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">struct</span><span class="hl-1">([</span><span class="hl-5">n</span><span class="hl-1">, </span><span class="hl-5">vla</span><span class="hl-1">], </span><span class="hl-4">&#39;st&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">alloc</span><span class="hl-1">(</span><span class="hl-6">32</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">arr</span><span class="hl-1"> = [[</span><span class="hl-4">&#39;k1&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;v1&#39;</span><span class="hl-1">], [</span><span class="hl-4">&#39;k2&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;v2&#39;</span><span class="hl-1">], [</span><span class="hl-4">&#39;k3&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;etc&#39;</span><span class="hl-1">]];</span><br/><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">fill</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">st</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">({</span><span class="hl-5">a:</span><span class="hl-1"> </span><span class="hl-5">arr</span><span class="hl-1">}, </span><span class="hl-5">b</span><span class="hl-1">),</span><br/><span class="hl-1">             </span><span class="hl-6">1</span><span class="hl-1"> + (</span><span class="hl-6">2</span><span class="hl-1"> * ((</span><span class="hl-6">2</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">) + (</span><span class="hl-6">2</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">)) + (</span><span class="hl-6">2</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">) + (</span><span class="hl-6">3</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">)));</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">span</span><span class="hl-1"> = </span><span class="hl-5">st</span><span class="hl-1">.</span><span class="hl-3">getSpan</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">span</span><span class="hl-1">, </span><span class="hl-6">20</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;036b31007631006b32007632006b330065746300&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">             .</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">slice</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">, </span><span class="hl-5">span</span><span class="hl-1">)), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">st</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), {</span><span class="hl-5">n:</span><span class="hl-1"> </span><span class="hl-6">3</span><span class="hl-1">, </span><span class="hl-5">a:</span><span class="hl-1"> </span><span class="hl-5">arr</span><span class="hl-1">});</span>
</code></pre>
<p>See <a href="http://pabigot.github.io/buffer-layout/module-Layout-OffsetLayout.html">OffsetLayout</a>.</p>

<a href="#a-c-flexible-array-member-with-implicit-length" id="a-c-flexible-array-member-with-implicit-length" style="color: inherit; text-decoration: none;">
  <h3>A C flexible array member with implicit length</h3>
</a>
<p>When data is obtained over a packetized interface the length of the
packet can provide implicit limits on the last field.</p>
<p>The C definition:</p>
<pre><code><span class="hl-5">struct</span><span class="hl-1"> </span><span class="hl-5">ds</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">uint8_t</span><span class="hl-1"> </span><span class="hl-5">prop</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-5">uint16_t</span><span class="hl-1"> </span><span class="hl-5">data</span><span class="hl-1">[];</span><br/><span class="hl-1">};</span>
</code></pre>
<p>The buffer-layout way:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">st</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">struct</span><span class="hl-1">([</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u8</span><span class="hl-1">(</span><span class="hl-4">&#39;prop&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">                    </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">seq</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u16</span><span class="hl-1">(),</span><br/><span class="hl-1">                           </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">greedy</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u16</span><span class="hl-1">().</span><span class="hl-5">span</span><span class="hl-1">),</span><br/><span class="hl-1">                           </span><span class="hl-4">&#39;data&#39;</span><span class="hl-1">)],</span><br/><span class="hl-1">                   </span><span class="hl-4">&#39;ds&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;21010002030405&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">deepEqual</span><span class="hl-1">(</span><span class="hl-5">st</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), {</span><span class="hl-5">prop:</span><span class="hl-1"> </span><span class="hl-6">33</span><span class="hl-1">, </span><span class="hl-5">data:</span><span class="hl-1"> [</span><span class="hl-6">0x0001</span><span class="hl-1">, </span><span class="hl-6">0x0302</span><span class="hl-1">, </span><span class="hl-6">0x0504</span><span class="hl-1">]});</span><br/><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">fill</span><span class="hl-1">(</span><span class="hl-6">0xFF</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">st</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">({</span><span class="hl-5">prop:</span><span class="hl-1"> </span><span class="hl-6">9</span><span class="hl-1">, </span><span class="hl-5">data:</span><span class="hl-1"> [</span><span class="hl-6">5</span><span class="hl-1">, </span><span class="hl-6">6</span><span class="hl-1">]}, </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1"> + </span><span class="hl-6">2</span><span class="hl-1"> * </span><span class="hl-6">2</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;0905000600FFFF&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span>
</code></pre>

<a href="#tagged-values-or-variable-length-unions" id="tagged-values-or-variable-length-unions" style="color: inherit; text-decoration: none;">
  <h3>Tagged values, or variable-length unions</h3>
</a>
<p>Storing arbitrary data using a leading byte to identify the content then
a value that takes up only as much room as is necessary.</p>
<p>The example also shows how to extend the variant recognition API to
support abitrary constant without consuming space for them in the
encoded union.  This could be used to make something similar to
<a href="http://bsonspec.org/spec.html">BSON</a>.</p>
<p>Here&#39;s the code that defines the union, the variants, and the
recognition of <code>true</code> and <code>false</code> values for <code>b</code> as distinct variants:</p>
<pre><code><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">un</span><span class="hl-1"> = </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">union</span><span class="hl-1">(</span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u8</span><span class="hl-1">(</span><span class="hl-4">&#39;t&#39;</span><span class="hl-1">));</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">u8</span><span class="hl-1"> = </span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;B&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">u8</span><span class="hl-1">(), </span><span class="hl-4">&#39;u8&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">s16</span><span class="hl-1"> = </span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;h&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">s16</span><span class="hl-1">(), </span><span class="hl-4">&#39;s16&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">s48</span><span class="hl-1"> = </span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;Q&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">s48</span><span class="hl-1">(), </span><span class="hl-4">&#39;s48&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">cstr</span><span class="hl-1"> = </span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;s&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">cstr</span><span class="hl-1">(), </span><span class="hl-4">&#39;str&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">tr</span><span class="hl-1"> = </span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;T&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">const</span><span class="hl-1">(</span><span class="hl-0">true</span><span class="hl-1">), </span><span class="hl-4">&#39;b&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">fa</span><span class="hl-1"> = </span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">addVariant</span><span class="hl-1">(</span><span class="hl-4">&#39;F&#39;</span><span class="hl-1">.</span><span class="hl-3">charCodeAt</span><span class="hl-1">(</span><span class="hl-6">0</span><span class="hl-1">), </span><span class="hl-5">lo</span><span class="hl-1">.</span><span class="hl-3">const</span><span class="hl-1">(</span><span class="hl-0">false</span><span class="hl-1">), </span><span class="hl-4">&#39;b&#39;</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">b</span><span class="hl-1"> = </span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">alloc</span><span class="hl-1">(</span><span class="hl-6">1</span><span class="hl-1"> + </span><span class="hl-6">6</span><span class="hl-1">);</span><br/><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">configGetSourceVariant</span><span class="hl-1">(</span><span class="hl-0">function</span><span class="hl-1">(</span><span class="hl-5">src</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-10">if</span><span class="hl-1"> (</span><span class="hl-5">src</span><span class="hl-1">.</span><span class="hl-3">hasOwnProperty</span><span class="hl-1">(</span><span class="hl-4">&#39;b&#39;</span><span class="hl-1">)) {</span><br/><span class="hl-1">    </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-5">src</span><span class="hl-1">.</span><span class="hl-5">b</span><span class="hl-1"> ? </span><span class="hl-5">tr</span><span class="hl-1"> : </span><span class="hl-5">fa</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-10">return</span><span class="hl-1"> </span><span class="hl-0">this</span><span class="hl-1">.</span><span class="hl-3">defaultGetSourceVariant</span><span class="hl-1">(</span><span class="hl-5">src</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code></pre>
<p>And here are examples of encoding, checking the encoded length, and
decoding each of the alternatives:</p>
<pre><code><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">fill</span><span class="hl-1">(</span><span class="hl-6">0xff</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">({</span><span class="hl-5">u8:</span><span class="hl-1"> </span><span class="hl-6">1</span><span class="hl-1">}, </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1"> + </span><span class="hl-6">1</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">getSpan</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">2</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;4201ffffffffff&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">).</span><span class="hl-5">u8</span><span class="hl-1">, </span><span class="hl-6">1</span><span class="hl-1">);</span><br/><br/><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">fill</span><span class="hl-1">(</span><span class="hl-6">0xff</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">({</span><span class="hl-5">s16:</span><span class="hl-1"> -</span><span class="hl-6">32000</span><span class="hl-1">}, </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1"> + </span><span class="hl-6">2</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">getSpan</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">3</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;680083ffffffff&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">).</span><span class="hl-5">s16</span><span class="hl-1">, -</span><span class="hl-6">32000</span><span class="hl-1">);</span><br/><br/><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">fill</span><span class="hl-1">(</span><span class="hl-6">0xff</span><span class="hl-1">);</span><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-2">v48</span><span class="hl-1"> = </span><span class="hl-8">Math</span><span class="hl-1">.</span><span class="hl-3">pow</span><span class="hl-1">(</span><span class="hl-6">2</span><span class="hl-1">, </span><span class="hl-6">47</span><span class="hl-1">) - </span><span class="hl-6">1</span><span class="hl-1">;</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">({</span><span class="hl-5">s48:</span><span class="hl-1"> </span><span class="hl-5">v48</span><span class="hl-1">}, </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1"> + </span><span class="hl-6">6</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">getSpan</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">7</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;51ffffffffff7f&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">).</span><span class="hl-5">s48</span><span class="hl-1">, </span><span class="hl-5">v48</span><span class="hl-1">);</span><br/><br/><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">fill</span><span class="hl-1">(</span><span class="hl-6">0xff</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">({</span><span class="hl-5">b:</span><span class="hl-1"> </span><span class="hl-0">true</span><span class="hl-1">}, </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">getSpan</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;54ffffffffffff&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">strictEqual</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">).</span><span class="hl-5">b</span><span class="hl-1">, </span><span class="hl-0">true</span><span class="hl-1">);</span><br/><br/><span class="hl-5">b</span><span class="hl-1">.</span><span class="hl-3">fill</span><span class="hl-1">(</span><span class="hl-6">0xff</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">encode</span><span class="hl-1">({</span><span class="hl-5">b:</span><span class="hl-1"> </span><span class="hl-0">false</span><span class="hl-1">}, </span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">getSpan</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">1</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">equal</span><span class="hl-1">(</span><span class="hl-5">Buffer</span><span class="hl-1">.</span><span class="hl-3">from</span><span class="hl-1">(</span><span class="hl-4">&#39;46ffffffffffff&#39;</span><span class="hl-1">, </span><span class="hl-4">&#39;hex&#39;</span><span class="hl-1">).</span><span class="hl-3">compare</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">), </span><span class="hl-6">0</span><span class="hl-1">);</span><br/><span class="hl-5">assert</span><span class="hl-1">.</span><span class="hl-3">strictEqual</span><span class="hl-1">(</span><span class="hl-5">un</span><span class="hl-1">.</span><span class="hl-3">decode</span><span class="hl-1">(</span><span class="hl-5">b</span><span class="hl-1">).</span><span class="hl-5">b</span><span class="hl-1">, </span><span class="hl-0">false</span><span class="hl-1">);</span>
</code></pre>
<p><strong>NOTE</strong> This code tickles a long-standing <a href="https://github.com/nodejs/node/pull/3994">bug in
Buffer.writeInt{L,B}E</a>; if you
are using Node prior to 4.2.4 or 5.2.0 you should update.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-class"><a href="classes/BitField.html" class="tsd-kind-icon">Bit<wbr/>Field</a></li><li class="tsd-kind-class"><a href="classes/BitStructure.html" class="tsd-kind-icon">Bit<wbr/>Structure</a></li><li class="tsd-kind-class"><a href="classes/Blob.html" class="tsd-kind-icon">Blob</a></li><li class="tsd-kind-class"><a href="classes/Boolean.html" class="tsd-kind-icon">Boolean</a></li><li class="tsd-kind-class"><a href="classes/CString.html" class="tsd-kind-icon">CString</a></li><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/Constant.html" class="tsd-kind-icon">Constant</a></li><li class="tsd-kind-class"><a href="classes/Double.html" class="tsd-kind-icon">Double</a></li><li class="tsd-kind-class"><a href="classes/DoubleBE.html" class="tsd-kind-icon">DoubleBE</a></li><li class="tsd-kind-class"><a href="classes/ExternalLayout.html" class="tsd-kind-icon">External<wbr/>Layout</a></li><li class="tsd-kind-class"><a href="classes/Float.html" class="tsd-kind-icon">Float</a></li><li class="tsd-kind-class"><a href="classes/FloatBE.html" class="tsd-kind-icon">FloatBE</a></li><li class="tsd-kind-class"><a href="classes/GreedyCount.html" class="tsd-kind-icon">Greedy<wbr/>Count</a></li><li class="tsd-kind-class"><a href="classes/Int.html" class="tsd-kind-icon">Int</a></li><li class="tsd-kind-class"><a href="classes/IntBE.html" class="tsd-kind-icon">IntBE</a></li><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/Layout.html" class="tsd-kind-icon">Layout</a></li><li class="tsd-kind-class"><a href="classes/NearInt64.html" class="tsd-kind-icon">Near<wbr/>Int64</a></li><li class="tsd-kind-class"><a href="classes/NearInt64BE.html" class="tsd-kind-icon">Near<wbr/>Int64BE</a></li><li class="tsd-kind-class"><a href="classes/NearUInt64.html" class="tsd-kind-icon">NearUInt64</a></li><li class="tsd-kind-class"><a href="classes/NearUInt64BE.html" class="tsd-kind-icon">NearUInt64BE</a></li><li class="tsd-kind-class"><a href="classes/OffsetLayout.html" class="tsd-kind-icon">Offset<wbr/>Layout</a></li><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/Sequence.html" class="tsd-kind-icon">Sequence</a></li><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/Structure.html" class="tsd-kind-icon">Structure</a></li><li class="tsd-kind-class"><a href="classes/UInt.html" class="tsd-kind-icon">UInt</a></li><li class="tsd-kind-class"><a href="classes/UIntBE.html" class="tsd-kind-icon">UIntBE</a></li><li class="tsd-kind-class"><a href="classes/UTF8.html" class="tsd-kind-icon">UTF8</a></li><li class="tsd-kind-class"><a href="classes/Union.html" class="tsd-kind-icon">Union</a></li><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/UnionDiscriminator.html" class="tsd-kind-icon">Union<wbr/>Discriminator</a></li><li class="tsd-kind-class"><a href="classes/UnionLayoutDiscriminator.html" class="tsd-kind-icon">Union<wbr/>Layout<wbr/>Discriminator</a></li><li class="tsd-kind-class"><a href="classes/VariantLayout.html" class="tsd-kind-icon">Variant<wbr/>Layout</a></li><li class="tsd-kind-interface"><a href="interfaces/LayoutObject.html" class="tsd-kind-icon">Layout<wbr/>Object</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#bindConstructorLayout" class="tsd-kind-icon">bind<wbr/>Constructor<wbr/>Layout</a></li><li class="tsd-kind-function"><a href="modules.html#bits" class="tsd-kind-icon">bits</a></li><li class="tsd-kind-function"><a href="modules.html#blob" class="tsd-kind-icon">blob</a></li><li class="tsd-kind-function"><a href="modules.html#checkUint8Array" class="tsd-kind-icon">check<wbr/>Uint8<wbr/>Array</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#constant" class="tsd-kind-icon">constant</a></li><li class="tsd-kind-function"><a href="modules.html#cstr" class="tsd-kind-icon">cstr</a></li><li class="tsd-kind-function"><a href="modules.html#f32" class="tsd-kind-icon">f32</a></li><li class="tsd-kind-function"><a href="modules.html#f32be" class="tsd-kind-icon">f32be</a></li><li class="tsd-kind-function"><a href="modules.html#f64" class="tsd-kind-icon">f64</a></li><li class="tsd-kind-function"><a href="modules.html#f64be" class="tsd-kind-icon">f64be</a></li><li class="tsd-kind-function"><a href="modules.html#greedy" class="tsd-kind-icon">greedy</a></li><li class="tsd-kind-function"><a href="modules.html#nameWithProperty" class="tsd-kind-icon">name<wbr/>With<wbr/>Property</a></li><li class="tsd-kind-function"><a href="modules.html#ns64" class="tsd-kind-icon">ns64</a></li><li class="tsd-kind-function"><a href="modules.html#ns64be" class="tsd-kind-icon">ns64be</a></li><li class="tsd-kind-function"><a href="modules.html#nu64" class="tsd-kind-icon">nu64</a></li><li class="tsd-kind-function"><a href="modules.html#nu64be" class="tsd-kind-icon">nu64be</a></li><li class="tsd-kind-function"><a href="modules.html#offset" class="tsd-kind-icon">offset</a></li><li class="tsd-kind-function"><a href="modules.html#s16" class="tsd-kind-icon">s16</a></li><li class="tsd-kind-function"><a href="modules.html#s16be" class="tsd-kind-icon">s16be</a></li><li class="tsd-kind-function"><a href="modules.html#s24" class="tsd-kind-icon">s24</a></li><li class="tsd-kind-function"><a href="modules.html#s24be" class="tsd-kind-icon">s24be</a></li><li class="tsd-kind-function"><a href="modules.html#s32" class="tsd-kind-icon">s32</a></li><li class="tsd-kind-function"><a href="modules.html#s32be" class="tsd-kind-icon">s32be</a></li><li class="tsd-kind-function"><a href="modules.html#s40" class="tsd-kind-icon">s40</a></li><li class="tsd-kind-function"><a href="modules.html#s40be" class="tsd-kind-icon">s40be</a></li><li class="tsd-kind-function"><a href="modules.html#s48" class="tsd-kind-icon">s48</a></li><li class="tsd-kind-function"><a href="modules.html#s48be" class="tsd-kind-icon">s48be</a></li><li class="tsd-kind-function"><a href="modules.html#s8" class="tsd-kind-icon">s8</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#seq" class="tsd-kind-icon">seq</a></li><li class="tsd-kind-function tsd-has-type-parameter"><a href="modules.html#struct" class="tsd-kind-icon">struct</a></li><li class="tsd-kind-function"><a href="modules.html#u16" class="tsd-kind-icon">u16</a></li><li class="tsd-kind-function"><a href="modules.html#u16be" class="tsd-kind-icon">u16be</a></li><li class="tsd-kind-function"><a href="modules.html#u24" class="tsd-kind-icon">u24</a></li><li class="tsd-kind-function"><a href="modules.html#u24be" class="tsd-kind-icon">u24be</a></li><li class="tsd-kind-function"><a href="modules.html#u32" class="tsd-kind-icon">u32</a></li><li class="tsd-kind-function"><a href="modules.html#u32be" class="tsd-kind-icon">u32be</a></li><li class="tsd-kind-function"><a href="modules.html#u40" class="tsd-kind-icon">u40</a></li><li class="tsd-kind-function"><a href="modules.html#u40be" class="tsd-kind-icon">u40be</a></li><li class="tsd-kind-function"><a href="modules.html#u48" class="tsd-kind-icon">u48</a></li><li class="tsd-kind-function"><a href="modules.html#u48be" class="tsd-kind-icon">u48be</a></li><li class="tsd-kind-function"><a href="modules.html#u8" class="tsd-kind-icon">u8</a></li><li class="tsd-kind-function"><a href="modules.html#uint8ArrayToBuffer" class="tsd-kind-icon">uint8<wbr/>Array<wbr/>To<wbr/>Buffer</a></li><li class="tsd-kind-function"><a href="modules.html#union" class="tsd-kind-icon">union</a></li><li class="tsd-kind-function"><a href="modules.html#unionLayoutDiscriminator" class="tsd-kind-icon">union<wbr/>Layout<wbr/>Discriminator</a></li><li class="tsd-kind-function"><a href="modules.html#utf8" class="tsd-kind-icon">utf8</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited property</span></li><li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>